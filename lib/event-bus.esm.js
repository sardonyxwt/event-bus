var t=function(){return(t=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,e)},e=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}(function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(e,t),e.prototype.revertArray=function(t){return t.map(this.revert)}}(function(){function t(){}return t.prototype.convertArray=function(t){return t.map(this.convert)},t}()),function(t,n){void 0===t&&(t=16),void 0===n&&(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var e="";e.length<t;)e+=n.charAt(Math.floor(Math.random()*n.length));return e}),r=function(t){var n=0,r=t+":"+e(4)+"-"+e(4)+"-"+e(4)+"-"+e(4);return function(){return r+":"+ ++n}};var i=new Map,o=r("EventBus"),u=r("EventBusListener"),s={onCreate:function(){return null},onEvent:function(){return null},onEventListenerError:function(){return null}},a=function(){function n(t){this._events=[],this._queue=[],this._listeners=new Map;var n=t.name,e=t.isFrozen,r=t.isImmutabilityEnabled;this.name=n,this.isImmutabilityEnabled=r,this._isFrozen=e}return Object.defineProperty(n.prototype,"isLocked",{get:function(){return this._isFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"supportEvents",{get:function(){return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),i=0;for(n=0;n<e;n++)for(var o=arguments[n],u=0,s=o.length;u<s;u++,i++)r[i]=o[u];return r}(this._events)},enumerable:!1,configurable:!0}),n.prototype.registerEvent=function(t){var n=this;if(this._isFrozen)throw new Error("This event bus is locked you can't add new event.");if(this.isEventPresent(t)||t in this)throw new Error("Event with name "+t+" is duplicate or reserved in event bus "+this.name+".");this._events.push(t);var e=function(){return t.charAt(0).toUpperCase()+t.slice(1)},r="on"+e(),i="publish"+e();this[r]=function(e){n.subscribe(e,[t])};var o=function(e){return n.publish(t,e)};return this[i]=o,o},n.prototype.publish=function(n,e){var r=this,i=function(){r.isImmutabilityEnabled&&e&&"object"==typeof e&&function t(n){return Object.getOwnPropertyNames(n).forEach((function(e){var r=n[e];"object"==typeof r&&null!==r&&t(r)})),Object.freeze(n)}(e);var i={eventBusName:r.name,eventName:n,data:e};(s.onEvent(i),r._listeners.forEach((function(n){try{n&&n(i)}catch(n){s.onEventListenerError(t(t({},i),{reason:n}))}})),r._queue.shift(),r._queue.length>0)&&(0,r._queue[0])()},o=0===this._queue.length;this._queue.push(i),o&&i()},n.prototype.subscribe=function(t,n){var e=this;void 0===n&&(n=[]),n.forEach((function(t){if(!e.isEventPresent(t))throw new Error("Event ("+t+") not present in scope.")}));var r=u();return this._listeners.set(r,0===n.length?t:function(e){-1!==n.findIndex((function(t){return t===e.eventName}))&&t(e)}),Object.assign((function(){return e.unsubscribe(r)}),{listenerId:r})},n.prototype.unsubscribe=function(t){return this._listeners.delete(t)},n.prototype.lock=function(){this._isFrozen=!0},n.prototype.isEventPresent=function(t){return-1!==this._events.findIndex((function(n){return n===t}))},n}();function c(t){return i.has(t)}function f(t){void 0===t&&(t={});var n=t.name,e=void 0===n?o():n,r=t.isFrozen,u=void 0!==r&&r,f=t.isImmutabilityEnabled,h=void 0!==f&&f;if(c(e))throw new Error("Event bus name must unique");var p=new a({name:e,isFrozen:u,isImmutabilityEnabled:h});return i.set(e,p),s.onCreate(p),p}function h(t){return i.get(t)}function p(t){Object.assign(s,t)}export{f as createEventBus,h as getEventBus,c as isEventBusExist,p as setEventBusDevTool};
