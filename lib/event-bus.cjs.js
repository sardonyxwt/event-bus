"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},n=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}(function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)})(n,t),n.prototype.revertArray=function(t){return t.map(this.revert)}}(function(){function t(){}return t.prototype.convertArray=function(t){return t.map(this.convert)},t}()),function(t,e){void 0===t&&(t=16),void 0===e&&(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var n="";n.length<t;)n+=e.charAt(Math.floor(Math.random()*e.length));return n}),r=function(t){var e=0,r=t+":"+n(4)+"-"+n(4)+"-"+n(4)+"-"+n(4);return function(){return r+":"+ ++e}};var o=new Map,i=r("EventBus"),u=r("EventBusListener"),s={onCreate:function(){return null},onEvent:function(){return null},onEventListenerError:function(){return null}},c=function(){function e(t){this._events=[],this._queue=[],this._listeners=new Map;var e=t.name,n=t.isFrozen,r=t.isImmutabilityEnabled;this.name=e,this.isImmutabilityEnabled=r,this._isFrozen=n}return Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportEvents",{get:function(){return function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],u=0,s=i.length;u<s;u++,o++)r[o]=i[u];return r}(this._events)},enumerable:!1,configurable:!0}),e.prototype.registerEvent=function(t){var e=this;if(this._isFrozen)throw new Error("This event bus is locked you can't add new event.");if(this.isEventPresent(t)||t in this)throw new Error("Event with name "+t+" is duplicate or reserved in event bus "+this.name+".");this._events.push(t);var n=function(){return t.charAt(0).toUpperCase()+t.slice(1)},r="on"+n(),o="publish"+n();this[r]=function(n){e.subscribe(n,[t])};var i=function(n){return e.publish(t,n)};return this[o]=i,i},e.prototype.publish=function(e,n){var r=this,o=function(){r.isImmutabilityEnabled&&n&&"object"==typeof n&&function t(e){return Object.getOwnPropertyNames(e).forEach((function(n){var r=e[n];"object"==typeof r&&null!==r&&t(r)})),Object.freeze(e)}(n);var o={eventBusName:r.name,eventName:e,data:n};(s.onEvent(o),r._listeners.forEach((function(e){try{e&&e(o)}catch(e){s.onEventListenerError(t(t({},o),{reason:e}))}})),r._queue.shift(),r._queue.length>0)&&(0,r._queue[0])()},i=0===this._queue.length;this._queue.push(o),i&&o()},e.prototype.subscribe=function(t,e){var n=this;void 0===e&&(e=[]),e.forEach((function(t){if(!n.isEventPresent(t))throw new Error("Event ("+t+") not present in scope.")}));var r=u();return this._listeners.set(r,0===e.length?t:function(n){-1!==e.findIndex((function(t){return t===n.eventName}))&&t(n)}),Object.assign((function(){return n.unsubscribe(r)}),{listenerId:r})},e.prototype.unsubscribe=function(t){return this._listeners.delete(t)},e.prototype.lock=function(){this._isFrozen=!0},e.prototype.isEventPresent=function(t){return-1!==this._events.findIndex((function(e){return e===t}))},e}();function a(t){return o.has(t)}exports.createEventBus=function(t){void 0===t&&(t={});var e=t.name,n=void 0===e?i():e,r=t.isFrozen,u=void 0!==r&&r,f=t.isImmutabilityEnabled,p=void 0!==f&&f;if(a(n))throw new Error("Event bus name must unique");var v=new c({name:n,isFrozen:u,isImmutabilityEnabled:p});return o.set(n,v),s.onCreate(v),v},exports.getEventBus=function(t){return o.get(t)},exports.isEventBusExist=a,exports.setEventBusDevTool=function(t){Object.assign(s,t)};
